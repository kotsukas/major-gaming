<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –±—Ä–æ–Ω–∏ - Major Gaming</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        .status-page {
            min-height: 100vh;
            padding-top: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .status-container {
            width: 100%;
            max-width: 500px;
            padding: 2rem;
        }
        .status-card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 2.5rem;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
        }
        .status-card-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        .status-card-header h1 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }
        .status-card-header p {
            color: var(--text-muted);
            font-size: 0.95rem;
        }
        .status-form .form-group input {
            padding-left: 3rem;
        }
        .status-form .input-wrapper {
            position: relative;
        }
        .status-form .input-wrapper i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }
        
        /* Results */
        .results {
            margin-top: 2rem;
            display: none;
        }
        .results.show { display: block; }
        .results-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }
        .results-header h3 {
            font-size: 1.1rem;
        }
        .booking-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.3s;
            animation: fadeIn 0.3s ease forwards;
        }
        .booking-card:hover {
            border-color: var(--primary);
            transform: translateX(5px);
        }
        .booking-card:nth-child(2) { animation-delay: 0.1s; }
        .booking-card:nth-child(3) { animation-delay: 0.2s; }
        .booking-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .booking-id {
            font-weight: 700;
            color: var(--primary);
        }
        .status {
            padding: 0.35rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        .status.pending {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }
        .status.confirmed {
            background: rgba(0, 240, 255, 0.2);
            color: var(--primary);
        }
        .status.cancelled {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        .booking-details {
            display: grid;
            gap: 0.75rem;
        }
        .booking-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .booking-row .label {
            color: var(--text-muted);
            font-size: 0.9rem;
        }
        .booking-row .value {
            font-weight: 500;
        }
        .no-results {
            text-align: center;
            padding: 2rem;
            color: var(--text-muted);
        }
        .no-results i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        .back-link {
            text-align: center;
            margin-top: 2rem;
        }
        .back-link a {
            color: var(--text-muted);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: color 0.3s;
        }
        .back-link a:hover {
            color: var(--primary);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }
        .loading.show { display: block; }
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-left">
                <div class="nav-toggle" id="navToggle" onclick="toggleMenu()">
                    <span></span>
                    <span></span>
                </div>
            </div>
            <a href="index.html" class="nav-logo">
                <span class="logo-icon">üéÆ</span>
                <span class="logo-text">MAJOR<span class="logo-accent">GAMING</span></span>
            </a>
            <div class="nav-right">
                <div class="lang-dropdown" id="langDropdown">
                    <div class="lang-toggle" onclick="toggleLangDropdown()">
                        <span id="langText">RU</span>
                        <i class="fas fa-chevron-up" id="langArrow"></i>
                    </div>
                    <div class="lang-menu" id="langMenu">
                        <div class="lang-option" data-lang="uz" onclick="selectLang(this.dataset.lang)">UZ</div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–µ –º–µ–Ω—é -->
    <div class="fullscreen-menu" id="navMenu">
        <button class="menu-close-btn" onclick="toggleMenu()">
            <i class="fas fa-times"></i>
        </button>
        <div class="menu-content">
            <a href="index.html#home" class="menu-link">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="index.html#games" class="menu-link">–ò–≥—Ä—ã</a>
            <a href="index.html#about" class="menu-link">–û –Ω–∞—Å</a>
            <a href="index.html#pricing" class="menu-link">–¶–µ–Ω—ã</a>
            <a href="index.html#gallery" class="menu-link">–ì–∞–ª–µ—Ä–µ—è</a>
            <a href="index.html#booking" class="menu-link">–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</a>
            <a href="index.html#contact" class="menu-link">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
            <a href="index.html#referral" class="menu-link">–ë–æ–Ω—É—Å—ã</a>
            <a href="status.html" class="menu-link active-link">–°—Ç–∞—Ç—É—Å –±—Ä–æ–Ω–∏</a>
        </div>
    </div>
    <div class="menu-overlay" id="menuOverlay" onclick="toggleMenu()"></div>

    <div class="status-page">
        <div class="status-container">
            <div class="status-card">
                <div class="status-card-header">
                    <h1>üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –±—Ä–æ–Ω–∏</h1>
                    <p>–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞, —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø—Ä–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏</p>
                </div>
                
                <form class="status-form" id="checkForm" onsubmit="checkStatus(event)">
                    <div class="form-group">
                        <label><i class="fas fa-phone"></i> –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
                        <div class="input-wrapper">
                            <i class="fas fa-phone"></i>
                            <input type="tel" id="phoneInput" placeholder="+998 XX XXX XX XX" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block btn-lg" id="submitBtn">
                        <i class="fas fa-search"></i> –ù–∞–π—Ç–∏ –º–æ–∏ –±—Ä–æ–Ω–∏
                    </button>
                </form>
                
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>–ò—â–µ–º –≤–∞—à–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è...</p>
                </div>
                
                <div class="results" id="results">
                    <div class="results-header">
                        <i class="fas fa-list"></i>
                        <h3>–í–∞—à–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
                    </div>
                    <div id="bookingsList"></div>
                </div>
            </div>
            
            <div class="back-link">
                <a href="index.html">
                    <i class="fas fa-arrow-left"></i>
                    –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é
                </a>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script>
        // Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDVO0HWDUQfVFLHmqIE2ifIOrdxKrPDPbo",
            authDomain: "major-gaming.firebaseapp.com",
            projectId: "major-gaming",
            storageBucket: "major-gaming.firebasestorage.app",
            messagingSenderId: "602576348146",
            appId: "1:602576348146:web:fcf160f7d412d5f23bc16b"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è
        function toggleMenu() {
            const menu = document.getElementById('navMenu');
            const toggle = document.getElementById('navToggle');
            const overlay = document.getElementById('menuOverlay');
            if (menu) menu.classList.toggle('active');
            if (toggle) toggle.classList.toggle('active');
            if (overlay) overlay.classList.toggle('active');
            document.body.style.overflow = menu.classList.contains('active') ? 'hidden' : '';
        }

        function toggleLangDropdown() {
            document.getElementById('langDropdown').classList.toggle('active');
        }

        function selectLang(lang) {
            document.getElementById('langDropdown').classList.remove('active');
            document.getElementById('langText').textContent = lang.toUpperCase();
            const langOption = document.querySelector('.lang-option');
            if (langOption) {
                const otherLang = lang === 'ru' ? 'uz' : 'ru';
                langOption.textContent = otherLang.toUpperCase();
                langOption.dataset.lang = otherLang;
            }
        }

        document.addEventListener('click', function(e) {
            const dropdown = document.getElementById('langDropdown');
            if (dropdown && !dropdown.contains(e.target)) {
                dropdown.classList.remove('active');
            }
        });
        
        // –ú–∞—Å–∫–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        document.getElementById('phoneInput').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 0 && !value.startsWith('998')) {
                value = '998' + value;
            }
            if (value.length > 12) value = value.slice(0, 12);
            
            let formatted = '';
            if (value.length > 0) formatted = '+' + value.slice(0, 3);
            if (value.length > 3) formatted += ' ' + value.slice(3, 5);
            if (value.length > 5) formatted += ' ' + value.slice(5, 8);
            if (value.length > 8) formatted += ' ' + value.slice(8, 10);
            if (value.length > 10) formatted += ' ' + value.slice(10, 12);
            e.target.value = formatted;
        });
        
        function checkStatus(e) {
            e.preventDefault();
            
            const phone = document.getElementById('phoneInput').value.trim();
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            const bookingsList = document.getElementById('bookingsList');
            const submitBtn = document.getElementById('submitBtn');
            
            if (phone.replace(/\D/g, '').length < 12) {
                alert('–í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
                return;
            }
            
            loading.classList.add('show');
            results.classList.remove('show');
            submitBtn.disabled = true;
            
            db.collection('bookings')
                .get()
                .then(function(snapshot) {
                    loading.classList.remove('show');
                    submitBtn.disabled = false;
                    
                    const bookings = [];
                    snapshot.forEach(function(doc) {
                        const data = doc.data();
                        if (data.phone === phone) {
                            bookings.push(data);
                        }
                    });
                    bookings.sort((a, b) => b.id - a.id);
                    
                    if (bookings.length === 0) {
                        bookingsList.innerHTML = `
                            <div class="no-results">
                                <i class="fas fa-inbox"></i>
                                <p>–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>
                                <p style="font-size: 0.85rem; margin-top: 0.5rem;">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω–æ–º–µ—Ä–∞</p>
                            </div>
                        `;
                    } else {
                        bookingsList.innerHTML = bookings.map((b, i) => {
                            const date = new Date(b.datetime);
                            const formattedDate = date.toLocaleDateString('ru-RU', {day: 'numeric', month: 'long', year: 'numeric'});
                            const formattedTime = date.toLocaleTimeString('ru-RU', {hour: '2-digit', minute: '2-digit'});
                            const statusText = {
                                'pending': '‚è≥ –û–∂–∏–¥–∞–µ—Ç',
                                'confirmed': '‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ',
                                'cancelled': '‚ùå –û—Ç–º–µ–Ω–µ–Ω–æ'
                            };
                            return `
                                <div class="booking-card">
                                    <div class="booking-header">
                                        <span class="booking-id">–ë—Ä–æ–Ω—å #${bookings.length - i}</span>
                                        <span class="status ${b.status}">${statusText[b.status] || b.status}</span>
                                    </div>
                                    <div class="booking-details">
                                        <div class="booking-row">
                                            <span class="label">üìÖ –î–∞—Ç–∞</span>
                                            <span class="value">${formattedDate}</span>
                                        </div>
                                        <div class="booking-row">
                                            <span class="label">üïê –í—Ä–µ–º—è</span>
                                            <span class="value">${formattedTime}</span>
                                        </div>
                                        <div class="booking-row">
                                            <span class="label">üñ• –ü–ö</span>
                                            <span class="value">${b.pcs || 1} —à—Ç.</span>
                                        </div>
                                        <div class="booking-row">
                                            <span class="label">üíé –¢–∞—Ä–∏—Ñ</span>
                                            <span class="value">${b.tariff}</span>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('');
                    }
                    results.classList.add('show');
                })
                .catch(function(error) {
                    console.log('Error:', error);
                    loading.classList.remove('show');
                    submitBtn.disabled = false;
                    alert('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
                });
        }
    </script>
</body>
</html>